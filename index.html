<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="No more crowded pages and page anxiety. Speed Read shows one word at a time using RSVP technique. Read 2-3x faster with focused, distraction-free reading. Perfect for students tackling dense textbooks and research papers.">
    <meta name="keywords" content="speed reading app, RSVP reader, reading anxiety help, read faster, focus reading, student reading tool, textbook reader, rapid serial visual presentation, word by word reader, reading comprehension, overcome reading anxiety, page anxiety, dense text reader">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://speed-read-rsvp.vercel.app/">
    <meta property="og:title" content="Speed Read - No More Page Anxiety">
    <meta property="og:description" content="No more crowded pages and page anxiety. Just fast, focused reading. Read 2-3x faster with RSVP technique.">
    <meta property="og:image" content="https://speed-read-rsvp.vercel.app/assets/og-image.png">

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Speed Read - No More Page Anxiety">
    <meta name="twitter:description" content="No more crowded pages and page anxiety. Just fast, focused reading.">
    <meta name="twitter:image" content="https://speed-read-rsvp.vercel.app/assets/og-image.png">

    <title>Speed Read - Free RSVP Speed Reading App | No More Page Anxiety</title>
    <link rel="icon" type="image/png" href="assets/logo/SpeedReadFavicon.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#6366f1">

    <!-- Structured Data for Rich Results -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Speed Read",
        "description": "No more crowded pages and page anxiety. Just fast, focused reading. RSVP-based speed reading app for students and professionals.",
        "url": "https://speed-read-rsvp.vercel.app/",
        "applicationCategory": "EducationalApplication",
        "operatingSystem": "Web Browser",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "featureList": [
            "RSVP (Rapid Serial Visual Presentation)",
            "Adjustable reading speed (200-1000 WPM)",
            "PDF and text file support",
            "Progress tracking and statistics",
            "Works offline (PWA)",
            "Cloud sync with Google Sign-in"
        ],
        "screenshot": "https://speed-read-rsvp.vercel.app/assets/og-image.png"
    }
    </script>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <link rel="apple-touch-icon" href="assets/logo/SpeedReadFavicon.png">
    <link rel="stylesheet" href="css/styles.css">
    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
</head>

<body>
    <!-- Main Container -->
    <div id="app" class="app-container">

        <!-- Header -->
        <header class="app-header">
            <div class="app-brand">
                <img src="assets/logo/SpeedReadFavicon.png" alt="Speed Read" class="app-logo">
                <h1 class="app-title">Speed Read</h1>
            </div>
            <div class="header-actions">
                <button id="authBtn" class="btn btn-secondary auth-btn hidden">Sign In</button>
                <button id="settingsBtn" class="settings-btn" aria-label="Settings">‚öôÔ∏è</button>
            </div>
        </header>

        <!-- Input Section -->
        <section id="inputSection" class="input-section" style="flex: 1;
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    flex-direction: column;
    justify-content: center;">

            <!-- Library Section (works for everyone, syncs when signed in) -->
            <div id="librarySection" class="library-container">
                <div class="library-header">
                    <h2>Your Library</h2>
                    <div class="library-actions">
                        <button id="syncBtn" class="icon-btn sync-btn hidden" title="Sync with cloud">‚òÅ</button>
                        <button id="refreshLibraryBtn" class="icon-btn" title="Refresh">‚Üª</button>
                    </div>
                </div>
                <div id="documentList" class="document-list">
                    <!-- Documents will be injected here -->
                    <div class="empty-state">Loading documents...</div>
                </div>
                <div class="divider"><span>OR ADD NEW</span></div>
            </div>

            <!-- Stats Dashboard -->
            <div id="statsSection" class="stats-dashboard">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">&#128293;</div>
                        <div class="stat-value" id="streakValue">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="wordsReadTodayValue">0</div>
                        <div class="stat-label">Words Today</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalWordsValue">0</div>
                        <div class="stat-label">Lifetime Words</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgWpmValue">0</div>
                        <div class="stat-label">Avg WPM (7d)</div>
                    </div>
                </div>
                <div class="stats-actions">
                    <span><span id="docsCompletedValue">0</span> docs completed</span>
                    <button id="streakFreezeBtn" class="btn btn-secondary btn-small"
                        title="Freeze your streak for 7 extra days">
                        &#10052; Freeze Streak
                    </button>
                </div>
            </div>

            <div class="input-container">
                <h2>Enter Your Text</h2>

                <!-- Text Input -->
                <textarea id="textInput" class="text-input" placeholder="Paste your text here or upload a file..."
                    aria-label="Text input for speed reading"></textarea>

                <div class="input-meta">
                    <span id="charCounter" class="char-counter">0 characters</span>
                    <button id="clearBtn" class="btn btn-secondary">Clear</button>
                </div>

                <!-- File Upload -->
                <div class="file-upload-section">
                    <label for="fileInput" class="file-label">
                        üìÅ Upload File (.txt or .pdf)
                    </label>
                    <input type="file" id="fileInput" accept=".txt,.pdf" class="file-input"
                        aria-label="Upload text or PDF file">
                    <div id="uploadStatus" class="upload-status"></div>
                </div>

                <!-- Start Button -->
                <button id="startBtn" class="btn btn-primary btn-large">
                    Start Reading
                </button>
            </div>

            <!-- Footer -->
            <footer class="input-footer">
                <a href="https://github.com/adithya-ag/Speed-Read" target="_blank" rel="noopener" class="github-link">
                    <svg height="16" width="16" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                    View on GitHub
                </a>
                <span class="license-text">Open source under GPL-3.0</span>
            </footer>
        </section>

        <!-- Reading Section -->
        <section id="readingSection" class="reading-section hidden">
            <!-- Reading Display Area -->
            <div class="reading-display">
                <div id="focusGuide" class="focus-guide hidden"></div>
                <!-- Glass Tube Word Display -->
                <div class="glass-tube-container">
                    <div class="glass-tube">
                        <div id="previousWord" class="context-word previous-word"></div>
                        <div class="tube-bubble">
                            <div id="wordDisplay" class="word-display current-word" aria-live="polite"></div>
                        </div>
                        <div id="nextWord" class="context-word next-word"></div>
                    </div>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="progress-container">
                <div id="progressBar" class="progress-bar" role="slider" aria-label="Click to jump to position"
                    title="Click to jump to position">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <div class="progress-info">
                    <span id="progressText">Word 0 / 0</span>
                    <span id="timeRemaining">Time: 0:00</span>
                </div>
                <!-- Progress hover tooltip -->
                <div id="progressTooltip" class="progress-tooltip hidden"></div>
            </div>

            <!-- Control Footer -->
            <div class="control-footer">
                <!-- Row 1: Playback Controls -->
                <div class="footer-controls">
                    <button id="exitBtn" class="back-btn" aria-label="Back to input" title="Back to input">
                        <span class="back-arrow">&#8592;</span> Back
                    </button>

                    <div class="playback-controls">
                        <button id="skipBackBtn" class="ctrl-btn" aria-label="Skip back 10 words"
                            title="Skip back 10 words">
                            &#9194; <span class="skip-label">-10</span>
                        </button>
                        <button id="playBtn" class="ctrl-btn ctrl-play" aria-label="Play">&#9654;</button>
                        <button id="pauseBtn" class="ctrl-btn ctrl-play hidden" aria-label="Pause">&#9208;</button>
                        <button id="resetBtn" class="ctrl-btn" aria-label="Reset"
                            title="Reset to beginning">&#8634;</button>
                        <button id="skipForwardBtn" class="ctrl-btn" aria-label="Skip forward 10 words"
                            title="Skip forward 10 words">
                            <span class="skip-label">+10</span> &#9193;
                        </button>
                    </div>

                    <div class="speed-inline">
                        <input type="range" id="speedSlider" class="speed-slider-sm" min="200" max="1000" step="50"
                            value="300" aria-label="Reading speed">
                        <span class="speed-label"><span id="speedValue">300</span> WPM</span>
                    </div>
                </div>

                <!-- Row 2: Keyboard Shortcuts (desktop only) -->
                <div class="keyboard-hints desktop-only">
                    <kbd>Space</kbd> Play/Pause &middot;
                    <kbd>J</kbd><kbd>L</kbd> Skip &middot;
                    <kbd>&#8592;</kbd><kbd>&#8594;</kbd> Speed &middot;
                    <kbd>?</kbd> Help
                </div>

                <!-- Divider -->
                <div class="footer-divider"></div>

                <!-- Row 3: Tagline -->
                <div class="footer-tagline">Designed for reading 2 - 3x faster</div>
            </div>
        </section>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Settings</h2>
                    <button id="closeSettingsBtn" class="close-btn" aria-label="Close settings">‚úï</button>
                </div>
                <div class="modal-body">
                    <!-- Theme Toggle -->
                    <div class="setting-item">
                        <label for="themeToggle" class="setting-label">Theme</label>
                        <div class="toggle-container">
                            <span>Light</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="themeToggle">
                                <span class="toggle-slider"></span>
                            </label>
                            <span>Dark</span>
                        </div>
                    </div>

                    <!-- Font Size -->
                    <div class="setting-item">
                        <label for="fontSizeSlider" class="setting-label">
                            Reading Font Size: <span id="fontSizeValue">40</span>px
                        </label>
                        <input type="range" id="fontSizeSlider" min="24" max="72" value="40" step="4">
                    </div>

                    <!-- Focus Guide -->
                    <div class="setting-item">
                        <label class="setting-label">
                            <input type="checkbox" id="focusGuideToggle">
                            Show Focus Guide
                        </label>
                    </div>

                    <!-- Punctuation Pause -->
                    <div class="setting-item">
                        <label for="punctuationPause" class="setting-label">
                            Sentence Pause: <span id="pauseValue">200</span>ms
                        </label>
                        <input type="range" id="punctuationPause" min="0" max="500" value="200" step="50">
                    </div>

                    <!-- Data Management -->
                    <div class="setting-item">
                        <label class="setting-label">Data Management</label>
                        <div class="data-actions">
                            <button id="exportBtn" class="btn btn-secondary">Export Library (JSON)</button>
                            <button id="importBtn" class="btn btn-secondary">Import Library</button>
                            <input type="file" id="importFileInput" accept=".json" class="hidden">
                        </div>
                        <div class="data-actions" style="margin-top: 0.75rem;">
                            <button id="clearAllDataBtn" class="btn btn-danger">Clear All Local Data</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Error Toast -->
        <div id="errorToast" class="error-toast hidden">
            <span id="errorMessage"></span>
        </div>

        <!-- Skip Feedback Toast -->
        <div id="skipToast" class="skip-toast hidden">
            <span id="skipMessage"></span>
        </div>

        <!-- Keyboard Shortcuts Help Modal -->
        <div id="keyboardHelpModal" class="modal hidden">
            <div class="modal-content">
                <div class="modal-header">
                    <h2>‚å®Ô∏è Keyboard Shortcuts</h2>
                    <button id="closeKeyboardHelpBtn" class="close-btn" aria-label="Close help">‚úï</button>
                </div>
                <div class="modal-body">
                    <div class="shortcuts-list">
                        <div class="shortcut-item">
                            <kbd>Space</kbd>
                            <span>Play / Pause</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>J</kbd>
                            <span>Skip back 10 words</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>L</kbd>
                            <span>Skip forward 10 words</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>‚Üê</kbd>
                            <span>Decrease speed (-50 WPM)</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>‚Üí</kbd>
                            <span>Increase speed (+50 WPM)</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>R</kbd>
                            <span>Reset to beginning</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>Esc</kbd>
                            <span>Exit to input</span>
                        </div>
                        <div class="shortcut-item">
                            <kbd>?</kbd>
                            <span>Show this help</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Confirm Dialog Modal -->
        <div id="confirmModal" class="modal hidden">
            <div class="modal-content modal-small">
                <div class="modal-header">
                    <h2 id="confirmTitle">Confirm</h2>
                </div>
                <div class="modal-body">
                    <p id="confirmMessage"></p>
                    <div class="confirm-actions">
                        <button id="confirmCancelBtn" class="btn btn-secondary">Cancel</button>
                        <button id="confirmOkBtn" class="btn btn-danger">Delete</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Update Available Banner -->
        <div id="updateBanner" class="update-banner hidden">
            <span>A new version is available!</span>
            <button id="updateBtn" class="btn btn-primary btn-small">Update Now</button>
            <button id="dismissUpdateBtn" class="update-dismiss" aria-label="Dismiss">&times;</button>
        </div>
    </div>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            let refreshing = false;

            // Reload page when new SW takes over
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (!refreshing) {
                    refreshing = true;
                    window.location.reload();
                }
            });

            navigator.serviceWorker.register('/sw.js').then(reg => {
                console.log('SW registered:', reg.scope);

                // Check for updates on page load
                reg.update();

                // Listen for new service worker waiting
                reg.addEventListener('updatefound', () => {
                    const newWorker = reg.installing;

                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            // New version available, show update banner
                            console.log('New version available!');
                            document.getElementById('updateBanner').classList.remove('hidden');

                            // Store reference to new worker for update button
                            window.pendingServiceWorker = newWorker;
                        }
                    });
                });

                // Handle update button click
                document.getElementById('updateBtn').addEventListener('click', () => {
                    if (reg.waiting) {
                        reg.waiting.postMessage('SKIP_WAITING');
                    }
                });

                // Handle dismiss button
                document.getElementById('dismissUpdateBtn').addEventListener('click', () => {
                    document.getElementById('updateBanner').classList.add('hidden');
                });

            }).catch(err => console.warn('SW registration failed:', err));
        }
    </script>

    <!-- JavaScript Modules -->
    <!-- Supabase Core -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <!-- IndexedDB wrapper -->
    <script src="https://cdn.jsdelivr.net/npm/idb@8/build/umd.js"></script>

    <!-- App Scripts -->
    <script src="js/config.js"></script>
    <script src="js/db.js"></script>
    <script src="js/supabase-client.js"></script>
    <script src="js/sync.js"></script>

    <script src="js/parser.js"></script>
    <script src="js/reader.js"></script>
    <script src="js/stats.js"></script>
    <script src="js/app.js"></script>
</body>

</html>